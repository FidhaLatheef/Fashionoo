<%- include('userHeader') %>
<link rel="stylesheet" href="/assetsuser/css/Checkout.css" />

<body style="background-color: rgba(170, 71, 124, 0.068)">
  <!--::header part start::-->
  <header
    style="background-color: rgb(255, 255, 255)"
    class="main_menu home_menu"
  >
    <div class="container">
      <div class="row align-items-center justify-content-center">
        <div class="col-lg-12">
          <nav class="navbar navbar-expand-lg navbar-light">
            <button
              class="navbar-toggler"
              type="button"
              data-toggle="collapse"
              data-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span><i></i></span>
            </button>
            <img
              style="width:300px; height:100px;"
              src="/img/logo.png"
              alt=""
            />
           

            <div
              class="collapse navbar-collapse main-menu-item"
              id="navbarSupportedContent"
            >
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/products">Products</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/about">about</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/contact">Contact</a>
                </li>
              </ul>
            </div>

            <div class="hearer_icon d-flex align-items-center">
              <a href="/logout">
                <ion-icon
                  style="
                    height: 25px;
                    width: 25px;
                    margin-left: 30px;
                    margin-top: 2px;
                    color: black;
                  "
                  name="log-out-outline"
                ></ion-icon>
              </a>
              <a href="/cart">
                <ion-icon
                  style="
                    height: 25px;
                    width: 25px;
                    margin-left: 30px;
                    margin-top: 2px;
                    color: black;
                  "
                  name="cart-outline"
                ></ion-icon>
              </a>
              <a href="/profile">
                <ion-icon
                  style="
                    height: 25px;
                    width: 25px;
                    margin-left: 30px;
                    margin-top: 2px;
                    color: black;
                  "
                  name="person-circle-outline"
                ></ion-icon>
              </a>

              <a href="/whishlist">
                <ion-icon
                  style="
                    height: 25px;
                    width: 25px;
                    margin-left: 30px;
                    margin-top: 2px;
                    color: black;
                  "
                  name="heart-outline"
                ></ion-icon>
              </a>
              <span class="ml-1"> </span>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </header>

  <div class="container mt-3">
    <div class="d-flex justify-content-between align-items-center mb-5">
      <div class="d-flex flex-row align-items-center">
        <div style="margin-top: 5px; display: flex; justify-content: center">
          <h2
          style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: bold; color: rgba(184, 103, 153, 0.767);">
         Checkout</h2>
        </div>
        <!-- <h4 class="text-uppercase mt-1">Checkout</h4> -->
      </div>
      <a href="/cart" class="cancel com-color"
        ><button class="btn_1">Cancel</button></a
      >
    </div>
    <form action="/checkout" method="post">
      <div class="row">
        <div class="col-md-6">

          <% user.address.forEach((item,index)=>{ %>

          <div style="margin-top: 5px; display: flex;">
            <h4 style="font-family: cursive; font-weight: bold; color:  rgba(184, 103, 153, 0.767);">
              <b > Address <%=index+1 %> </b>

              <input type="radio" id="<%=item.id%>" name="address" value="<%=item.id %>" required style="margin-left: 10px;">
            </h4>
          </div>

          <label class="p-2 d-flex justify-content-between bg-pay mt-2" for="<%=item.id%>">
            <div class="col-10 d-flex flex-column">

              <span><b style="color: rgba(0, 0, 0, 0.836); font-family:  cursive;">Name : <%=item.name%></b><br /></span>

              <span><b style="color: rgba(0, 0, 0, 0.836); font-family: cursive;">Mobile : <%=item.mobile%></b><br /></span>

              <b style="color: rgba(0, 0, 0, 0.836); font-family:  cursive;">City : <%=item.city%></b>

              <b style="color: rgba(0, 0, 0, 0.836); font-family: cursive;">pincode : <%=item.pincode%></b>

              <div style="display: flex" class="mt-3 text-center">

                <a href="/delete-address/<%=item._id%>">
                  <button class="btn_5" type="button" onclick="return confirm('Are you sure you want to delete address')">Delete</button>
                </a>

                <a href="/edit-address/<%=item._id%>">
                  <button style="margin-left: 10px" class="btn_5" type="button">Edit</button>
                </a>

              </div>

            </div>
          </label>
          <% }) %>
        </div>

        <div class="col-md-4">
          
        <h3>  <b class="text-dark">Choose Payment Method</b></h3>
          <div class="bg-pay p-3 mt-2">
           
            <label class="d-flex justify-content-between mt-2" for="online">
                <h5>  <span class="fw-500">Online Payment</span></h5>
              <span
                ><input
                  type="radio"
                  name="payment"
                  id="online"
                  value="online"
                  required
              /></span>
            </label>
            <label class="d-flex justify-content-between mt-2" for="cod">
                <h5><span class="fw-500">Cash on delivery</span></h5>
              <span
                ><input type="radio" name="payment" id="cod" value="cod"
              /></span>
            </label>
            <ul>
              <h4>
                Total
                <span style="margin-left: 190px; color: rgb(0, 0, 0)" id="price"name="total"
                  ><%=totalPrice %></span
                >
              </h4>
            </ul>
            <div class="cart__discount mt-4"></div>
            <hr />
            <button class="btn_1" type="submit">
              Place Orders
            </button>
          </div>
        </div>
        <input
          type="hidden"
          id="hiddenPrice"
          name="total"
          placeholder=""
          value="<%=totalPrice %>"
        />
      </div>
    </form>
   
      <input type="text" id="code" class="btn_3" placeholder="Coupon code" />
      <button class="btn_1" onclick="couponCheck('<%=totalPrice %>')">
        Apply
      </button>
    
  </div>

  <script
    type="module"
    src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
  ></script>
  <script
    nomodule
    src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
  ></script>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>

  <script>
    async function couponCheck(total) {
      let code = document.getElementById("code").value;
      const response = await axios.get("/couponCheck/" + code + "/" + total);
      console.log(response);

      if (response.data.success == true) {
        let price = document.getElementById("price");
        let hiddenPrice = document.getElementById("hiddenPrice");
        price.textContent = response.data.subTotal;
        hiddenPrice.value = response.data.subTotal;
      } else {
        console.log("failed");
      }
    }
  </script>
</body>

<%- include('footer') %>
